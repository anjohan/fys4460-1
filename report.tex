\documentclass[11pt,british,a4paper]{report}
\pdfobjcompresslevel=0
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage[includeheadfoot,margin=0.8 in]{geometry}
\usepackage{siunitx,physics,cancel,upgreek,varioref,listings,booktabs,pdfpages,ifthen,polynom,todonotes}
%\usepackage{minted}
\usepackage{mathtools,upgreek,bigints}
\usepackage{babel}
\usepackage{graphicx}
\usepackage{float}
\usepackage{amsmath}
\usepackage{amssymb}
%\usepackage{fouriernc}
\usepackage[T1]{fontenc}
\usepackage{mathpazo}
\usepackage{inconsolata}
%\usepackage{eulervm}
%\usepackage{fontspec}
%\usepackage{unicode-math}
%\setmainfont{Tex Gyre Pagella}
%\setmathfont{Tex Gyre Pagella Math}
\usepackage{fancyhdr}
\usepackage[utf8]{inputenc}
\usepackage{textcomp}
\usepackage{lastpage}
\usepackage{microtype}
\usepackage[linktoc=all, bookmarks=true, pdfauthor={Anders Johansson},pdftitle={FYS3110 Hjemmeeksamen}]{hyperref}
\usepackage{tikz,pgfplots,pgfplotstable}
\usepgfplotslibrary{colorbrewer}
\pgfplotsset{cycle list/Set1}
\usetikzlibrary{spy}
\pgfplotsset{compat=1.8}
\renewcommand{\CancelColor}{\color{red}}
\let\oldexp=\exp
\renewcommand{\exp}[1]{\mathrm{e}^{#1}}
\renewcommand{\Re}[1]{\mathfrak{Re}\ifthenelse{\equal{#1}{}}{}{\left(#1\right)}}
\renewcommand{\Im}[1]{\mathfrak{Im}\ifthenelse{\equal{#1}{}}{}{\left(#1\right)}}
\renewcommand{\i}{\mathrm{i}}
\newcommand{\tittel}[1]{\title{#1 \vspace{-7ex}}\author{}\date{}\maketitle\thispagestyle{fancy}\pagestyle{fancy}\setcounter{page}{1}}

% \newcommand{\deloppg}[2][]{\subsection*{#2) #1}\addcontentsline{toc}{subsection}{#2)}\refstepcounter{subsection}\label{#2}}
% \newcommand{\oppg}[1]{\section*{Oppgave #1}\addcontentsline{toc}{section}{Oppgave #1}\refstepcounter{section}\label{oppg#1}}

\labelformat{section}{#1}
\labelformat{subsection}{exercise~#1}
\labelformat{subsubsection}{paragraph~#1}
\labelformat{equation}{equation~(#1)}
\labelformat{figure}{figure~#1}
\labelformat{table}{table~#1}

\renewcommand{\footrulewidth}{\headrulewidth}

%\setcounter{secnumdepth}{4}
\renewcommand{\thesection}{Oppgave \arabic{section}}
\renewcommand{\thesubsection}{\arabic{section}.\arabic{subsection})}
\renewcommand{\thesubsubsection}{\arabic{section}\alph{subsection}\roman{subsubsection})}
\setlength{\parindent}{0cm}
\setlength{\parskip}{1em}

\definecolor{bluekeywords}{rgb}{0.13,0.13,1}
\definecolor{greencomments}{rgb}{0,0.5,0}
\definecolor{redstrings}{rgb}{0.9,0,0}
\lstset{rangeprefix=\#/,
    rangesuffix=/,
    includerangemarker=false}
\renewcommand{\lstlistingname}{Kodesnutt}
\lstset{showstringspaces=false,
    basicstyle=\footnotesize\ttfamily,
    keywordstyle=\color{bluekeywords},
    commentstyle=\color{greencomments},
    numberstyle=\color{bluekeywords},
    stringstyle=\color{redstrings},
    breaklines=true,
    texcl=true
}
\colorlet{DarkGrey}{white!20!black}
\newcommand{\eqtag}[1]{\refstepcounter{equation}\tag{\theequation}\label{#1}}
\hypersetup{hidelinks=True}

\sisetup{detect-all}
\sisetup{exponent-product = \cdot, output-product = \cdot,per-mode=symbol}
% \sisetup{output-decimal-marker={,}}
\sisetup{round-mode = off, round-precision=3}
\sisetup{number-unit-product = \ }

\allowdisplaybreaks[4]
\fancyhf{}

\rhead{Project 1}
\rfoot{Page~\thepage{} of~\pageref{LastPage}}
\lhead{FYS4460}

%\definecolor{gronn}{rgb}{0.29, 0.33, 0.13}
\definecolor{gronn}{rgb}{0, 0.5, 0}

\newcommand{\husk}[2]{\tikz[baseline,remember picture,inner sep=0pt,outer sep=0pt]{\node[anchor=base] (#1) {\(#2\)};}}
\newcommand{\artanh}[1]{\operatorname{artanh}{\qty(#1)}}
\newcommand{\matrise}[1]{\begin{pmatrix}#1\end{pmatrix}}


\pgfplotstableset{1000 sep={\,},
                      assign column name/.style={/pgfplots/table/column name={\multicolumn{1}{c}{#1}}},
                      every head row/.style={before row=\toprule,after row=\midrule},
                      every last row/.style={after row=\bottomrule},
                      columns/n/.style={column name={\(n^*\)},column type={r}},
                      columns/N/.style={column name={\(N\)},sci},
                      columns/logN/.style={column name={\(\log(N)\)}},
                      columns/logn/.style={column name={\(\log(n^*)\)}}
                      }

\newread\infile

%start
\begin{document}
\title{FYS4460: Project 1}
\author{Anders Johansson}
%\maketitle

\begin{titlepage}
%\includegraphics[width=\textwidth]{fysisk.pdf}
\vspace*{\fill}
\begin{center}
\textsf{
    \Huge \textbf{Project 1}\\\vspace{0.5cm}
    \Large \textbf{FYS4460 - Disordered systems and percolation}\\
    \vspace{8cm}
    Anders Johansson\\
    \today\\
}
\vspace{1.5cm}
\includegraphics{uio.pdf}\\
\vspace*{\fill}
\end{center}
\end{titlepage}
\null
\pagestyle{empty}
\newpage

\pagestyle{fancy}
\setcounter{page}{1}

\subsection*{a)}
I have used the following workflow to see how the velocity distribution evolves with time:
\begin{itemize}
    \item LAMMPs generates an fcc structure, and saves a data file.
    \item A python script reads the data file, and replaces the velocities (which are zero) with uniformly distributed velocities in a specified range.
    \item LAMMPs runs a simulation from the resulting data file.
    \item A python script uses ovito to parse the simulation data, makes histograms for each saved frame and computes the correlation.
\end{itemize}
When calculating the histograms, I have made sure the same bins are used for all frames by first finding the maximum velocity attained by any atom during the simulation, and then using equally sized bins in the range \(\qty[-v_{\max},v_{\max}]\). One histogram is computed for each direction, and then the average of these is taken.

The correlation is computed by normalising the histograms and taking the dot product with the histogram computed from the final frame. As the velocity distribution approaches the final distribution, the correlation should approach 1.

From \vref{fig:distribution} it is clear that the velocity distribution rapidly changes from a uniform to a gaussian shape. \Vref{fig:correlation} indicates that this happens exponentially, i.e.
\[
    C(t) = 1-C_0\exp{-t/\tau}\,,
\]
where \(C(t)\) is the correlation, \(C_0\) is the initial correlation and \(\tau\) is a time constant. If this is the case,
\[
    \ln(1-C) = \ln(C_0\exp{-t/\tau}) = \ln(C_0) - t/\tau\,,
\]
so when plotted on a logarithmic scale, \(1-C(t)\) should be a linear function with slope \(-1/\tau\). The result is shown in~\vref{fig:logcorrelation}, and while the noise increases as the correlation approaches unity, it is clear from the first half of the graph that the trend is linear, confirming the exponential approach to \(1\).

The time constant, \(\tau\), can thus be estimated by picking out the linear part of the data in \vref{fig:logcorrelation} and finding the slope. While this sounds simple, picking out a linear bit of a graph is hard to program. Fortunately,
\[
    C(\tau) = 1-C_0\exp{-\tau/\tau} = 1-C_0/\mathrm{e} \implies 1-C(\tau)=C_0/\mathrm{e} \implies \frac{1-C(\tau)}{1-C(0)} = \frac{1}{\mathrm{e}}\,,
\]
so the time constant can also be found by checking when \(1-C\) has reached \(1/\mathrm{e}\) of its initial value, which is very simple to program. The result is
\openin\infile=a/data/tau.dat
\read\infile to \timeconstant
\closein\infile
\[
    \tau = \SI[round-mode=figures,round-precision=2]{\timeconstant}{\pico\s}\,.
\]

\begin{figure}[tbhp]
    \centering
    \begin{tikzpicture}
        \begin{axis}[thick,axis lines=middle,
            enlarge x limits=0.05, enlarge y limits=0.1,width=6in,height=3in,
            xlabel={\(t\ \qty[\si{\angstrom\per\femto\s}]\)}, ylabel=Distribution,
            legend style={draw=none}, legend cell align=left,
            ]
            \addplot+[mark=none] table {a/data/velocity_distribution1.dat};
            \addlegendentry{Initial};
            \addplot+[mark=none] table {a/data/velocity_distribution2.dat};
            \addlegendentry{\(\frac{1}{5}\) of simulation}
            \addplot+[mark=none] table {a/data/velocity_distribution3.dat};
            \addlegendentry{Final}
        \end{axis}
    \end{tikzpicture}
    \caption{Distribution of particle velocities in the initial and final configurations, as well as after one fifth of the simulation time. The shape transforms rapidly from uniform to gaussian.}\label{fig:distribution}
\end{figure}
\begin{figure}[tbh]
    \centering
    \begin{tikzpicture}
        \begin{axis}[thick,axis lines=middle, axis y discontinuity=crunch,
            ymin=0.912, enlarge x limits=0.05, enlarge y limits=0.1,width=6in,height=3in,
            xlabel={\(t\ \qty[\si{\pico\s}]\)}, ylabel=Correlation]
            \addplot+[mark=none,] table[x expr={\thisrowno{0}/1000}] {a/data/velocity_correlation.dat};
            \draw (axis cs:\timeconstant,0.895) coordinate (A);
            \draw (axis cs:\timeconstant,0.99) coordinate (B);
        \end{axis}
        \draw[dashed] (B) -- (A) node[below] {\(\tau\)};
    \end{tikzpicture}
    \caption{Correlation of the velocity distribution as a function of time. The approach to \(1\) appears to be exponential, as confirmed by \vref{fig:logcorrelation}.}\label{fig:correlation}
\end{figure}
\begin{figure}[tbh]
    \centering
    \begin{tikzpicture}
        \begin{semilogyaxis}[thick,axis y line=middle, axis x line=bottom,
            ymin=0.00001,ymax=0.1,
            enlarge x limits=0.05, enlarge y limits=0.1,width=6in,height=3in,
            xlabel={\(t\ \qty[\si{\pico\s}]\)}, ylabel={\(1-C(t)\)}]
            \addplot+[mark=none,] table[x expr={\thisrowno{0}/1000},y expr={1-\thisrowno{1}}] {a/data/velocity_correlation.dat};
        \end{semilogyaxis}
    \end{tikzpicture}
    \caption{Deviation of the correlation from \(1\), plotted on a logarithmic scale. The linear trend of the first part indicates exponential decay.}\label{fig:logcorrelation}
\end{figure}




\end{document}
